# HWComposer
关于 HWComposer 的功能部分我们就直接看[官方的介绍](https://link.zhihu.com/?target=https%3A//source.android.google.cn/devices/graphics/arch-sf-hwc.html%3Fauthuser%3D0%26hl%3Dde)即可

1. Hardware Composer HAL (HWC) 用于确定通过可用硬件来合成缓冲区的最有效方法。
作为 HAL，其实现是特定于设备的，而且通常由显示设备硬件原始设备制造商 (OEM) 完成。
2. 当您考虑使用叠加平面时，很容易发现这种方法的好处，它会在显示硬件（而不是 GPU）中合成多个缓冲区。
例如，假设有一部普通 Android 手机，其屏幕方向为纵向，状态栏在顶部，导航栏在底部，其他区域显示应用内容。
每个层的内容都在单独的缓冲区中。您可以使用以下任一方法处理合成（后一种方法可以显著提高效率）：
3. 将应用内容渲染到暂存缓冲区中，然后在其上渲染状态栏，再在其上渲染导航栏，最后将暂存缓冲区传送到显示硬件。
4. 将三个缓冲区全部传送到显示硬件，并指示它从不同的缓冲区读取屏幕不同部分的数据。
5. 显示处理器功能差异很大。叠加层的数量（无论层是否可以旋转或混合）以及对定位和叠加的限制很难通过 API 表达。
为了适应这些选项，HWC 会执行以下计算（由于硬件供应商可以定制决策代码，因此可以在每台设备上实现最佳性能）：
6. SurfaceFlinger 向 HWC 提供一个完整的层列表，并询问“您希望如何处理这些层？”
7. HWC 的响应方式是将每个层标记为叠加层或 GLES 合成。
8. SurfaceFlinger 会处理所有 GLES 合成，将输出缓冲区传送到 HWC，并让 HWC 处理其余部分。
9. 当屏幕上的内容没有变化时，叠加平面的效率可能会低于 GL 合成。
当叠加层内容具有透明像素且叠加层混合在一起时，尤其如此。在此类情况下，
HWC 可以选择为部分或全部层请求 GLES 合成，并保留合成的缓冲区。
如果 SurfaceFlinger 返回来要求合成同一组缓冲区，HWC 可以继续显示先前合成的暂存缓冲区。
这可以延长闲置设备的电池续航时间。
10. 运行 Android 4.4 或更高版本的设备通常支持 4 个叠加平面。
尝试合成的层数多于叠加层数会导致系统对其中一些层使用 GLES 合成，这意味着应用使用的层数会对能耗和性能产生重大影响。